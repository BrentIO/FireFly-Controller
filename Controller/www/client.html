<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FireFly Controller</title>
    <link href="./bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
    <script src="./bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="./common.js"></script>
    <script type="text/javascript" src="./dexie/dexie.min.js"></script>
    <script type="text/javascript" src="./dexie/dexie-export-import.js"></script>
    <script type="text/javascript" src="./database.js"></script>
    <script type="text/javascript" src="./download/download.min.js"></script>
</head>

<body>
    <script>
        loadMenu(null, "menuItemClients");
        initDB();
    </script>

    <div class="container-fluid">
        <div class="row flex-nowrap">
            <div id="menubar" class="col-auto col-md-3 col-xl-2 px-sm-2 px-0 bg-dark"></div>
            <div class="col py-3">
                <div><a href="./clients.html">&larr; Back to Clients</a></div>
                <div class="pageTitle" id="pageTitle"></div>
                <div class="pageDescription" id="pageDescription"></div>
                <div>
                    <svg id="clientPreviewImage" viewbox="0 0 400 600">
                        <defs>
                            <radialGradient id="innerGradient">
                                <stop offset="10%" stop-color="#C0C0C0" />
                                <stop offset="95%" stop-color="#a6a6a6" />
                            </radialGradient>
                            <radialGradient id="emptyGradient">
                                <stop offset="10%" stop-color="#595959" />
                                <stop offset="95%" stop-color="#737373" />
                                </radialGradient>
                            <linearGradient id="outerGradient" gradientTransform="rotate(90)">
                                <stop class="stop1" offset="0%" stop-color="#C0C0C0" />
                                <stop class="stop2" offset="50%" stop-color="#C0C0C0" />
                                <stop class="stop3" offset="100%" stop-color="#a6a6a6"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <div class="mt-3">
                    <button class="btn btn-primary dropdown-toggle" role="button" id="addNewHID" role="button" data-bs-toggle="dropdown" aria-expanded="false">Add</button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" onclick="toggleAddButtonModal();">Button</a></li>
                        <li><a class="dropdown-item" onclick="toggleAddSwitchModal();">Switch</a></li>
                      </ul>
                    <button type="button" class="btn btn-outline-success" data-bs-toggle="button" id="invertButton" onclick="getClient()">Invert</button>
                </div>
                <div class="mt-3">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Color</th>
                                <th scope="col">Switch Type</th>
                                <th scope="col">Actions</th>
                                <th scope="col">Enabled</th>
                                <th scope="col">Move</th>
                                <th scope="col"></th>
                            </tr>
                          </thead>
                        <tbody id="hidList"></tbody>
                    </table>
                </div>
            </div> 
        </div>
    </div>


    <!-- Add New Button Modal -->
    <div class="modal fade" id="addNewButtonModal" tabindex="-1" aria-labelledby="addNewButtonModalLabel" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form class="needs-validation" novalidate id="addNewButtonForm">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="addNewButtonModalLabel">Add New Button</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="input-group mb-3">
                        <span class="input-group-text" id="input-group-color">Color</span>
                        <div class="input-group-text" id="addNewButtonColorPreview"></div>
                        <select class="form-select" aria-label="Color" id="addNewButtonColor" onchange="setColorPreview();" required>
                            <option value="" selected disabled>Select...</option>
                        </select>
                        <div class="invalid-feedback">
                            Select button color.
                        </div>
                    </div>
                    <div class="input-group mb-3">
                        <span class="input-group-text">Switch Type</span>
                        <select class="form-select" aria-label="Type" id="addNewButtonSwitchType" required >
                            <option value="NORMALLY_OPEN" selected>Normally Open</option>
                            <option value="NORMALLY_CLOSED">Normally Closed</option>
                        </select>
                        <div class="invalid-feedback">
                            Select button type.
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" type="button" id="addNewButtonModalAddButton" onclick="addNewButton_click();">Add</button>
                </div>
            </form>
            </div>
        </div>
    </div>


    <!-- Add New Switch Modal -->
    <div class="modal fade" id="addNewSwitchModal" tabindex="-1" aria-labelledby="addNewSwitchModalLabel" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="addNewSwitchModalLabel">Add New Switch</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="needs-validation" novalidate id="addNewSwitchForm">
                    <div class="input-group mb-3">
                        <span class="input-group-text">Switch Type</span>
                        <select class="form-select" aria-label="Type" id="addNewSwitchSwitchType" required >
                            <option value="NORMALLY_OPEN" selected>Normally Open</option>
                            <option value="NORMALLY_CLOSED">Normally Closed</option>
                        </select>
                        <div class="invalid-feedback">
                            Select a switch type.
                        </div>
                    </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" type="button" id="addNewSwitchModalAddButton" onclick="addNewSwitch_click();">Add</button>
                </div>

            </div>
        </div>
    </div>

    <!-- Add Action Modal-->
    <div class="modal fade" id="addActionModal" tabindex="-1" aria-labelledby="addActionModalLabel" data-bs-backdrop="static">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="addActionModalLabel">Add Action</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form class="needs-validation" novalidate id="addNewActionForm">
                    <input type="hidden" id="addNewActionHID" name="addNewActionHID" value="">
                    <div class="input-group mb-3 has-validation">
                        
                        <span class="input-group-text">When a</span>
                        <select class="form-select" id="addNewActionChangeState" required>
                            <option value="SHORT" selected>Short Change</option>
                            <option value="LONG">Long Change</option>
                        </select>
                        <span class="input-group-text">is observed, make</span>

                        <select class="form-select" id="addNewActionCircuit" required onchange="addActionDrawAvailableActionsForSelectedCircuit();">
                        </select>
                        <div class="invalid-feedback">
                            You must select a circuit.
                        </div>

                        <select class="form-select" id="addNewActionAction" required disabled>
                            <option value="" selected disabled>Select...</option>
                            <option value="INCREASE">Increase</option>
                            <option value="INCREASE_MAXIMUM">Increase Maximum</option>
                            <option value="DECREASE">Decrease</option>
                            <option value="DECREASE_MAXIMUM">Decrease Maximum</option>
                            <option value="TOGGLE">Toggle</option>
                        </select>
                        <div class="invalid-feedback">
                            Select an action to take.
                        </div>
                    
                    </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-primary" type="button" id="addNewSwitchModalAddButton" onclick="addActionSave_click();">Add</button>
                </div>
            </div>
        </div>
    </div>
</body>

<script>

    var client={};
    var colorList=[];
    var circuitList=[];


    var addNewButtonModal = new bootstrap.Modal('#addNewButtonModal');
    var addNewSwitchModal = new bootstrap.Modal('#addNewSwitchModal');
    var addActionModal = new bootstrap.Modal('#addActionModal');


    function toggleAddButtonModal(){
        addNewButtonModal.toggle();
    }


    function toggleAddSwitchModal(){
        addNewSwitchModal.toggle();
    }


    function toggleAddActionModal(element = null){

        if(element != null){
            document.getElementById("addNewActionHID").value = element;
        }
        addActionModal.toggle();
    }


    document.getElementById("addNewButtonModal").addEventListener('show.bs.modal', () => {

        form = document.getElementById("addNewButtonForm");
        form.reset();
        document.getElementById("addNewButtonColor").value = "";
        setColorPreview();
        form.classList.remove('was-validated');
    });


    document.getElementById("addNewSwitchModal").addEventListener('show.bs.modal', () => {

        form = document.getElementById("addNewSwitchForm");
        form.reset();
        form.classList.remove('was-validated');
    });


    document.getElementById("addActionModal").addEventListener('show.bs.modal', () => {

        form = document.getElementById("addNewActionForm");
        form.reset();
        document.getElementById('addNewActionCircuit').value = "";
        document.getElementById('addNewActionAction').disabled = true;
        form.classList.remove('was-validated');
    });

    async function getClient(){

        try{
            client = await db.clients.where('id').equals(parseInt(urlParams.get('id'))).first();

            await Promise.all(client.hids.map(async hid => {
                [hid.color] = await Promise.all([
                    db.colors.where('id').equals(hid.color || []).first()
                ]),
                await Promise.all(hid.actions.map(async action => {
                    [action.circuit] = await Promise.all([
                        db.circuits.where('id').equals(action.circuit).first()
                    ]),
                    [action.circuit.area] = await Promise.all([
                        db.areas.where('id').equals(action.circuit.area).first()
                    ])
                }))
            }));

            if(typeof client == "undefined"){
                throw new Error("Invalid ID.");
            };

            document.getElementById("pageTitle").innerText = client.name;
            document.getElementById("pageDescription").innerHTML = client.description;

            if(client.hids.length == 5){
                document.getElementById("invertButton").hidden = false;
            }else{
                document.getElementById("invertButton").hidden = true;
            }

            await getCircuitList();
            await drawHIDPicture();
            await drawHIDList();

        }catch(exception){
            errorHandler(exception);
            window.location.href = "./clients.html";
        }

    }


    function getHIDLocation(total, hid){

        locations = {"1":[[200,300]],"2":[[200,200],[200,400]],"3":[[200,150],[200,300],[200,450]],"4":[[125,200],[275,200],[125,400],[275,400]],"5":[[125,150],[275,150],[125,300],[275,300],[200,450]],"6":[[125,150],[275,150],[125,300],[275,300],[125,450],[275,450]],"51":[[200,150],[125,300],[275,300],[125,450],[275,450]]};

        try{

            if(locations[total] === undefined){
                throw new Error("Missing faceplate definition for size " + total);
            }

            if(locations[total][hid] === undefined){
                throw new Error("Missing HID definition for faceplate " + total + " HID " + (hid + 1));
            }

            return locations[total][hid];

        }catch(exception){
            errorHandler(exception);
        }
    }


    async function getColorList(){

        let colorListSelect = document.getElementById("addNewButtonColor");

        var i, L = colorListSelect.options.length - 1;
        for(i = L; i >= 0; i--) {
            colorListSelect.remove(i);
        }

        colorList = await db.colors.orderBy('name').toArray()
        colorList.forEach((color) =>{
            var opt = document.createElement('option');
            opt.value = color['id'];
            opt.innerHTML = `${color['name']}`;
            colorListSelect.append(opt);
        });

        var opt = document.createElement('option');
        opt.value = "";
        opt.disabled = true;
        opt.selected = true;
        opt.innerHTML = `Select...`;
        colorListSelect.prepend(opt);

    }


    function setColorPreview(){

        let colorListSelect = document.getElementById("addNewButtonColor");
        let colorPreview = document.getElementById("addNewButtonColorPreview");

        if(colorListSelect.value == ""){
            colorPreview.style = getComputedStyle(document.getElementById("input-group-color"));
            return;
        }

        colorList.forEach((color) => {
            if(color.id == colorListSelect.value){
                colorPreview.style.backgroundColor = color.hex;
            }
        })
    }


    function drawHIDPicture(){

        var svgns = "http://www.w3.org/2000/svg";
        var svg = document.getElementById('clientPreviewImage');
        var addNewHID = document.getElementById('addNewHID');

        try{

            if(!('hids' in client)){
                addNewHID.disabled = false;
                return;
            }

            for(const element of svg.querySelectorAll("circle")){
                element.remove();
            }

            for(const element of svg.querySelectorAll("rect")){
                element.remove();
            }

            if(client.hids.length >= maximumHIDsPerClient){
                addNewHID.disabled = true;
            }else{
                addNewHID.disabled = false;
            }

            for(let i = 0; i < client.hids.length; i++){

                hidLocation = getHIDLocation(client.hids.length, i);

                if(client.hids.length == 5 && document.getElementById("invertButton").classList.contains("active")){
                    hidLocation = getHIDLocation(51, i);
                }

                switch(client.hids[i].type){

                    case "BUTTON":
                        var outterButton = document.createElementNS(svgns, "circle");
                        outterButton.setAttributeNS(null, "cx", hidLocation[0]);
                        outterButton.setAttributeNS(null, "cy", hidLocation[1]);
                        outterButton.setAttributeNS(null, "r",  50);
                        outterButton.setAttributeNS(null, "fill", "url('#innerGradient')");
                        svg.appendChild(outterButton);

                        var innerButton = document.createElementNS(svgns, "circle");
                        innerButton.setAttributeNS(null, "cx", hidLocation[0]);
                        innerButton.setAttributeNS(null, "cy", hidLocation[1]);
                        innerButton.setAttributeNS(null, "r",  33);
                        innerButton.setAttributeNS(null, "stroke", `${client.hids[i]['color']['hex']}`);
                        innerButton.setAttributeNS(null, "stroke-width", "10px");
                        innerButton.setAttributeNS(null, "fill", "url('#innerGradient')");
                        svg.appendChild(innerButton);

                        break;

                    case "SWITCH":
                        var outterSwitch = document.createElementNS(svgns, "rect");
                        outterSwitch.setAttributeNS(null, "x", (hidLocation[0]-50));
                        outterSwitch.setAttributeNS(null, "y", (hidLocation[1]-30));
                        outterSwitch.setAttributeNS(null, "height",  50);
                        outterSwitch.setAttributeNS(null, "width",  100);
                        outterSwitch.setAttributeNS(null, "fill", "#737373");
                        svg.appendChild(outterSwitch);

                        var innerSwitch = document.createElementNS(svgns, "rect");
                        innerSwitch.setAttributeNS(null, "x", (hidLocation[0]-50));
                        innerSwitch.setAttributeNS(null, "y", (hidLocation[1]-30));
                        innerSwitch.setAttributeNS(null, "height",  50);
                        innerSwitch.setAttributeNS(null, "width",  30);
                        innerSwitch.setAttributeNS(null, "fill", "url('#innerGradient')");
                        svg.appendChild(innerSwitch);
                        break;

                    default:
                        throw new Error("Unknown HID type " + client.hids[i].type);
                        break;
                }
            }
   
        }catch(exception){
            errorHandler(exception);
        }
    }


    function drawHIDList(){
        var hidList = document.getElementById('hidList');
        hidList.innerHTML = '';

        let i=0;

        client.hids.forEach((hid) =>{

            let hidEntry = `
            <tr>
                <td class="align-middle">${i+1}</td>`

            if(typeof hid.color == "undefined"){
                hidEntry += `<td class="align-middle">None</td>`;
            }else{
                hidEntry += `<td class="align-middle">${hid.color.name}</td>`;
            }

            hidEntry += `<td class="align-middle">${hid.switch_type.replace("NORMALLY_OPEN", "Normally Open").replace("NORMALLY_CLOSED", "Normally Closed")}</td>
            <td class="align-middle">`;

            j = 0;

            hid.actions.forEach((action)=>{

                var change_state = "";
                var action_type = "";

                switch(action.change_state){
                    case "SHORT":
                        change_state = "Short Change";
                        break;
                    case "LONG":
                        change_state = "Long Change";
                        break;
                    default:
                        change_state = "Unknown Change State";
                        break;
                }

                switch (action.action){
                    case "INCREASE":
                        action_type = "Increase"; 
                        break;
                    case "INCREASE_MAXIMUM":
                        action_type = "Increase Maximum";
                        break;
                    case "DECREASE":
                        action_type = "Decrease";
                        break;
                    case "DECREASE_MAXIMUM":
                        action_type = "Decrease Maximum";
                        break;
                    case "TOGGLE":
                        action_type = "Toggle";
                        break;
                    default:
                        break;
                }

                hidEntry += `<div>${change_state}: ${action_type} ${action.circuit.name}  ${action.circuit.area.name} ${action.circuit.description} <img src="./icons/delete_forever.svg" title="Delete" id="controllerAddButton" class="btn actionDeleteButton" role="button" onclick="deleteAction(${i},${j});"></div>`

                j++;

            })

            hidEntry += `
                <div><button type="button" class="btn btn-outline-primary btn-sm" onclick="toggleAddActionModal(${i});">Add</button></div>
            </td>          

            <td class="align-middle">${hid.enabled.toString().replace("true", "Yes").replace("false", "<span class='text-danger'>No<span>")}</td>
            <td class="align-middle">`

            if(i != 0){
                hidEntry += `<button class="btn btn-outline-primary" role="button" onclick="moveHID(${i}, 'up');">&uarr;</button> `
            }

            if(i < client.hids.length-1){
                hidEntry += ` <button class="btn btn-outline-primary" role="button" onclick="moveHID(${i}, 'down');">&darr;</button>`
            }

            hidEntry += `</td>
                <td class="align-middle"><button type="button" class="btn btn-outline-danger" id="deleteHIDButtonChallenge_${i}" onclick="toggleConfirmDeleteHID(${i});">Delete</button>
                    <div class="input-group" id="confirmDeleteHID_${i}" hidden>
                            <input type="text" class="form-control" placeholder="type \'delete\'" id="confirmDeleteText_${i}" oninput="confirmDeleteHIDChallegeOnChange(${i});">
                            <button class="btn btn-secondary" type="button" onclick="toggleConfirmDeleteHID(${i})">Cancel</button>
                            <button class="btn btn-outline-danger" type="button" id="deleteHIDButtonConfirmed_${i}" onclick="deleteHID(${i});" disabled>Delete</button>
                    </div>
                </td>
            </tr>`

            hidList.insertAdjacentHTML('beforeend', hidEntry);
            i++;

        });
    }


    async function deleteAction(hid, element){

        await db.clients.where('id').equals(client.id).modify(client =>{
            client.hids[hid].actions.splice(element, 1)
        });

        await getClient();

    }


    function toggleConfirmDeleteHID(name){

        if(document.getElementById('deleteHIDButtonChallenge_'+name).hidden == false){
            document.getElementById('deleteHIDButtonChallenge_'+name).hidden = true;
            document.getElementById('confirmDeleteHID_'+name).hidden = false;
        }else{
            document.getElementById('deleteHIDButtonChallenge_'+name).hidden = false;
            document.getElementById('confirmDeleteHID_'+name).hidden = true;
            document.getElementById('confirmDeleteText_'+name).value = "";
        }
    }


    function confirmDeleteHIDChallegeOnChange(name){

        if(document.getElementById('confirmDeleteText_'+name).value == "delete"){
            document.getElementById('deleteHIDButtonConfirmed_'+name).disabled = false;
            document.getElementById('deleteHIDButtonConfirmed_'+name).classList.add('btn-danger');
            document.getElementById('deleteHIDButtonConfirmed_'+name).classList.remove('btn-outline-danger');
        }else{
            document.getElementById('deleteHIDButtonConfirmed_'+name).disabled = true;
            document.getElementById('deleteHIDButtonConfirmed_'+name).classList.add('btn-outline-danger');
            document.getElementById('deleteHIDButtonConfirmed_'+name).classList.remove('btn-danger');
        }
    }


    async function deleteHID(element){

        await db.clients.where('id').equals(client.id).modify(client =>{
            client.hids.splice(element, 1)
        });

        await getClient();
    }


    async function moveHID(element, direction){

        destination = element;

        if(direction == "down"){
            destination++;
        }else{
            destination--;
        }

        await db.clients.where('id').equals(client.id).modify(client =>
            client.hids = move_array(client.hids, element, destination)
        );

        await getClient();
    }


    async function addNewButton_click(){

        let form = document.getElementById("addNewButtonForm");
        form.checkValidity();
        form.classList.add('was-validated');

        if(!form.checkValidity()){
            return;
        }

        await addNewButtonToDatabase();
        await getClient();
        await toggleAddButtonModal();
    }


    async function addNewButtonToDatabase(){

        await db.clients.where('id').equals(client.id).modify(client =>
            client.hids.push({"color": parseInt(document.getElementById('addNewButtonColor').value), "type":"BUTTON", "switch_type":document.getElementById('addNewButtonSwitchType').value, "enabled": true, "actions":[]})
        );
    }


    async function addNewSwitch_click(){

        let form = document.getElementById("addNewSwitchForm");
        form.checkValidity();
        form.classList.add('was-validated');

        if(!form.checkValidity()){
            return;
        }

        await addNewSwitchToDatabase();
        await getClient();
        await toggleAddSwitchModal();
    }


    async function addNewSwitchToDatabase(){

        await db.clients.where('id').equals(client.id).modify(client =>
            client.hids.push({"type":"SWITCH", "switch_type":document.getElementById('addNewSwitchSwitchType').value, "enabled": true, "actions":[]})
        );
    }


    async function addActionSave_click(){

        let form = document.getElementById("addNewActionForm");
        form.checkValidity();
        form.classList.add('was-validated');

        if(!form.checkValidity()){
            return;
        }

        await addNewActionToDatabase();
        await getClient();
        await toggleAddActionModal();
    }


    async function addNewActionToDatabase(){

        await db.clients.where('id').equals(client.id).modify(client =>
            client.hids[parseInt(document.getElementById("addNewActionHID").value)].actions.push({
                "change_state": document.getElementById("addNewActionChangeState").value,
                "circuit": parseInt(document.getElementById("addNewActionCircuit").value),
                "action": document.getElementById("addNewActionAction").value
            })
        );

    }


    function addActionDrawAvailableActionsForSelectedCircuit(){

        document.getElementById('addNewActionAction').value = "";

        if(document.getElementById('addNewActionCircuit').value == ""){
            document.getElementById('addNewActionAction').disabled = true;
            
            return;
        }

        document.getElementById('addNewActionAction').disabled = false;

        circuitList.forEach((circuit) =>{

            if(circuit.id == parseInt(document.getElementById('addNewActionCircuit').value)){

                switch(circuit.relay.type){
                    case "BINARY":

                        for(var i = 0; i < document.getElementById('addNewActionAction').options.length; i++){
                            if(document.getElementById('addNewActionAction').options[i].value.includes("INCREASE") || document.getElementById('addNewActionAction').options[i].value.includes("DECREASE")){
                                document.getElementById('addNewActionAction').options[i].hidden = true;
                            }
                        }

                        break;

                    case "VARIABLE":

                        for(var i = 0; i < document.getElementById('addNewActionAction').options.length; i++){
                            if(document.getElementById('addNewActionAction').options[i].value.includes("INCREASE") || document.getElementById('addNewActionAction').options[i].value.includes("DECREASE")){
                                document.getElementById('addNewActionAction').options[i].hidden = false;
                            }
                        }

                        break;

                    default:
                        throw new Error("Unknown relay type " + circuit.relay.type);
                        break;
                }
            }
        });
    }


    async function getCircuitList(){
  
        let circuitSelect = document.getElementById("addNewActionCircuit");

        var i, L = circuitSelect.options.length - 1;
        for(i = L; i >= 0; i--) {
            circuitSelect.remove(i);
        }

        var opt = document.createElement('option');
        opt.value = "";
        opt.disabled = true;
        opt.selected = true;
        opt.innerHTML = `Select...`;
        circuitSelect.prepend(opt);

        circuitList = await db.circuits.orderBy('name').toArray();

        await Promise.all(circuitList.map(async circuit => {
            [circuit.area] = await Promise.all([
                db.areas.where('id').equals(circuit.area).first()
            ]),
            [circuit.relay] = await Promise.all([
                db.relay_models.where('id').equals(circuit.relay_model).first()
            ])
        }));

        circuitList.forEach((circuit) =>{
            var opt = document.createElement('option');
            opt.value = circuit['id'];
            opt.innerHTML = `${circuit['name']}: ${circuit.area.name} ${circuit.description}`;
            circuitSelect.appendChild(opt);
        });  
    }


    const urlParams = new URLSearchParams(window.location.search);

    if(isNaN(parseInt(urlParams.get('id')))){
        window.location.href = "./clients.html";
    }

    getClient();
    getColorList();

</script>
</html>